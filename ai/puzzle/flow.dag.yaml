$schema: https://azuremlschemas.azureedge.net/promptflow/latest/Flow.schema.json
environment:
  python_requirements_txt: requirements.txt
inputs:
  domain:
    type: string
    default: History
  level:
    type: string
    default: Intermediate
  topic:
    type: string
    default: History of French revolution
  form:
    type: string
    default: historic figures
  numErrors:
    type: int
    default: 2
  key:
    type: string
    default: ""
  complexity:
    type: int
    default: 5
  avoid:
    type: list
    default: []
outputs:
  gen:
    type: string
    reference: ${postprocess.output}
nodes:
- name: preprocess
  type: python
  source:
    type: code
    path: preprocess.py
  inputs:
    key: ${inputs.key}
    domain: ${inputs.domain}
- name: gen_program
  type: llm
  source:
    type: code
    path: gen_program.jinja2
  inputs:
    model: gpt-3.5-turbo
    max_tokens: 3900
    level: ${inputs.level}
    topic: ${inputs.topic}
    form: ${inputs.form}
    numBugs: ${inputs.numErrors}
    complexity: ${inputs.complexity}
    avoid: ${inputs.avoid}
  connection: prod_conn
  api: chat
  activate:
    when: ${preprocess.output.domain}
    is: Programming
- name: gen_history
  type: llm
  source:
    type: code
    path: gen_history.jinja2
  inputs:
    model: gpt-3.5-turbo
    max_tokens: 3900
    form: ${inputs.form}
    level: ${inputs.level}
    topic: ${inputs.topic}
    complexity: ${inputs.complexity}
    numErrors: ${inputs.numErrors}
    avoid: ${inputs.avoid}
  connection: prod_conn
  api: chat
  activate:
    when: ${preprocess.output.domain}
    is: History
- name: gen_chain
  type: llm
  source:
    type: code
    path: gen_chain.jinja2
  inputs:
    model: gpt-3.5-turbo
    max_tokens: 3900
    level: ${inputs.level}
    complexity: ${inputs.complexity}
    numErrors: ${inputs.numErrors}
    from: ${inputs.form}
    topic: ${inputs.topic}
    avoid: ${inputs.avoid}
  connection: prod_conn
  api: chat
  activate:
    when: ${preprocess.output.domain}
    is: Chain
- name: postprocess
  type: python
  source:
    type: code
    path: post_process.py
  inputs:
    domain: ${preprocess.output.domain}
    prog: ${gen_program.output}
    hist: ${gen_history.output}
    chain: ${gen_chain.output}
